<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKD Project Management Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1b;
            --bg-card: #232326;
            --bg-hover: #2a2a2d;
            --text-primary: #e8e8e9;
            --text-secondary: #9ca3af;
            --accent-blue: #7dd3fc;
            --accent-green: #86efac;
            --accent-orange: #fcd34d;
            --accent-red: #fca5a5;
            --accent-purple: #c4b5fd;
            --border-color: #333336;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            --pastel-green: #86efac;
            --pastel-green-dark: #4ade80;
            --pastel-red: #fca5a5;
            --pastel-red-dark: #f87171;
            --pastel-blue: #93c5fd;
            --pastel-blue-dark: #60a5fa;
            --pastel-purple: #c4b5fd;
            --pastel-purple-dark: #a78bfa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.02;
            z-index: 0;
            pointer-events: none;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.01) 35px, rgba(255,255,255,.01) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255,255,255,.01) 35px, rgba(255,255,255,.01) 70px);
        }

        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 6px;
            transition: background 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--pastel-purple);
        }

        *:focus-visible {
            outline: 2px solid var(--pastel-blue);
            outline-offset: 2px;
        }

        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .notification {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            min-width: 300px;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-color: var(--pastel-green);
        }

        .notification.error {
            border-color: var(--pastel-red);
        }

        .notification.info {
            border-color: var(--pastel-blue);
        }

        .password-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            padding: 3rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            min-width: 400px;
            z-index: 9999;
        }

        .password-logo {
            font-size: 2rem;
            font-weight: 700;
            color: var(--pastel-blue);
            text-align: center;
            margin-bottom: 1rem;
        }

        .password-title {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .password-subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 2rem;
        }

        .password-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }

        .password-input:focus {
            border-color: var(--pastel-blue);
        }

        .password-input.error {
            border-color: var(--pastel-red);
            animation: shake 0.3s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .password-error {
            color: var(--pastel-red);
            font-size: 0.875rem;
            text-align: center;
            margin-bottom: 1rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .password-error.show {
            opacity: 1;
        }

        .password-submit {
            width: 100%;
            padding: 1rem;
            background: var(--pastel-blue);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .password-submit:hover {
            background: var(--pastel-blue-dark);
            transform: translateY(-1px);
        }

        #dashboardWrapper {
            display: none;
        }

        .header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(35, 35, 38, 0.95);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--pastel-blue);
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-btn.active {
            background: var(--pastel-blue);
            color: var(--bg-primary);
            border-color: var(--pastel-blue);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        #lastUpdatedText {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .btn-primary {
            padding: 0.5rem 1rem;
            background: var(--pastel-purple);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: var(--pastel-purple-dark);
            transform: translateY(-1px);
        }

        .page-container {
            display: none;
            padding: 2rem;
        }

        .page-container.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s;
        }

        .stat-card:hover {
            border-color: var(--pastel-blue);
            transform: translateY(-2px);
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .dropdown-wrapper {
            position: relative;
        }

        .dropdown-trigger {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .dropdown-trigger:hover {
            background: var(--bg-hover);
            border-color: var(--pastel-blue);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .dropdown-item {
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--bg-hover);
        }

        .search-bar {
            flex: 1;
            min-width: 300px;
        }

        .search-bar input {
            width: 100%;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .search-bar input:focus {
            border-color: var(--pastel-blue);
        }

        #projectsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .project-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .project-card:hover {
            border-color: var(--pastel-blue);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .project-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .project-title:hover {
            color: var(--pastel-blue);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .project-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .project-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .edit-btn:hover {
            background: var(--bg-hover);
            border-color: var(--pastel-purple);
        }

        .notes-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .note-section {
            margin-bottom: 1.5rem;
        }

        .note-section:last-child {
            margin-bottom: 0;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-header h3 {
            font-size: 1rem;
            color: var(--pastel-blue);
        }

        .note-textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
            resize: vertical;
            font-family: inherit;
        }

        .note-textarea:focus {
            border-color: var(--pastel-blue);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--pastel-blue);
        }

        .multi-select {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            min-height: 44px;
        }

        .multi-select-tag {
            padding: 0.25rem 0.75rem;
            background: var(--pastel-blue);
            color: var(--bg-primary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .multi-select-tag button {
            background: none;
            border: none;
            color: var(--bg-primary);
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-secondary {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--pastel-blue);
        }

        .btn-save {
            padding: 0.75rem 1.5rem;
            background: var(--pastel-green);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save:hover {
            background: var(--pastel-green-dark);
            transform: translateY(-1px);
        }

        .settings-list-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: move;
        }

        .settings-list-item.drag-over {
            border-color: var(--pastel-blue);
            background: var(--bg-hover);
        }

        .drag-handle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: grab;
        }

        .note-header-controls {
            display: flex;
            gap: 0.5rem;
        }

        .btn-delete-note {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--pastel-red);
            color: var(--pastel-red);
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-delete-note:hover {
            background: var(--pastel-red);
            color: var(--bg-primary);
        }

        /* Timeline View Styles */
        .timeline-wrapper {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .timeline-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .timeline-controls-left {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .timeline-controls-right {
            display: flex;
            gap: 0.5rem;
        }

        .timeline-grid-container {
            overflow-x: auto;
            overflow-y: visible;
            border-radius: 8px;
            background: var(--bg-card);
        }

        .timeline-grid {
            display: grid;
            grid-template-columns: 250px repeat(var(--months-count, 12), 120px);
            min-width: min-content;
        }

        .timeline-header-row {
            display: contents;
        }

        .timeline-header-cell {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .timeline-header-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--pastel-blue);
            position: sticky;
            left: 0;
            top: 0;
            z-index: 11;
        }

        .timeline-body {
            display: contents;
        }

        .timeline-row {
            display: contents;
        }

        .timeline-project-label {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            position: sticky;
            left: 0;
            z-index: 9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: move;
        }

        .timeline-project-label:hover {
            background: var(--bg-hover);
        }

        .timeline-cell {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            position: relative;
            min-height: 60px;
        }

        .timeline-bar {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding: 0 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: move;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .timeline-bar:hover {
            transform: translateY(-50%) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 5;
        }

        .timeline-bar.dragging {
            opacity: 0.6;
            cursor: grabbing;
            z-index: 100;
        }

        .timeline-bar-content {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resize-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 8px;
            cursor: ew-resize;
            z-index: 10;
        }

        .resize-handle-left {
            left: 0;
            border-left: 2px solid transparent;
        }

        .resize-handle-right {
            right: 0;
            border-right: 2px solid transparent;
        }

        .resize-handle:hover {
            border-color: var(--pastel-blue);
        }

        .timeline-grid-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border-color);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .timeline-grid-line.visible {
            opacity: 0.3;
        }

        .timeline-totals {
            margin-top: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .timeline-totals h3 {
            margin-bottom: 1rem;
            color: var(--pastel-blue);
        }

        .resource-table {
            width: 100%;
            border-collapse: collapse;
        }

        .resource-table th,
        .resource-table td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            font-size: 0.875rem;
        }

        .resource-table th {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 600;
        }

        .resource-allocation-healthy {
            color: var(--pastel-green);
        }

        .resource-allocation-warning {
            color: var(--accent-orange);
        }

        .resource-allocation-danger {
            color: var(--pastel-red);
        }

        .user-badge {
            display: inline-block;
            padding: 0.125rem 0.375rem;
            background: rgba(124, 211, 252, 0.2);
            border-radius: 4px;
            font-size: 0.625rem;
            color: var(--pastel-blue);
        }

        @media (max-width: 768px) {
            #projectsPage .container {
                grid-template-columns: 1fr !important;
            }
            
            #projectsGrid {
                grid-template-columns: 1fr !important;
            }

            .timeline-grid {
                grid-template-columns: 200px repeat(var(--months-count, 12), 100px);
            }
        }
    </style>
</head>
<body>
    <div class="notification-container" id="notificationContainer"></div>

    <div id="passwordScreen">
        <div class="password-container">
            <div class="password-logo">PKD Dashboard</div>
            <h2 class="password-title">Secure Access</h2>
            <p class="password-subtitle">Please enter your password to continue</p>
            <input type="password" class="password-input" id="passwordInput" placeholder="Enter password" onkeypress="if(event.key === 'Enter') checkPassword()">
            <div class="password-error" id="passwordError">Incorrect password. Please try again.</div>
            <button class="password-submit" onclick="checkPassword()">Access Dashboard</button>
        </div>
    </div>

    <div id="dashboardWrapper">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="logo">PKD Dashboard</h1>
                    <div class="nav-buttons">
                        <button class="nav-btn active" onclick="showPage('projects')">Projects & Notes</button>
                        <button class="nav-btn" onclick="showPage('timeline')">Timeline View</button>
                    </div>
                </div>
                <div class="header-actions">
                    <span id="lastUpdatedText">Last Updated: Never</span>
                    <button class="btn-primary" id="projectsOnlyBtn" onclick="openCreateModal()">New Project</button>
                    <button class="btn-primary" id="manageBtn" onclick="openManageModal()">Manage Settings</button>
                    <button class="btn-primary" onclick="exportPKD()">Export PKD</button>
                    <button class="btn-primary" onclick="document.getElementById('fileInput').click()">Upload PKD</button>
                    <input type="file" id="fileInput" style="display: none;" accept=".txt" onchange="handleFileUpload(event)">
                </div>
            </div>
        </header>

        <!-- Projects Page -->
        <div id="projectsPage" class="page-container active">
            <div class="container" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; max-width: none; height: calc(100vh - 200px);">
                <div style="display: flex; flex-direction: column; overflow: hidden;">
                    <div id="statsSummary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div style="font-size: 2rem; color: var(--accent-blue); font-weight: 600;" id="activeCount">0</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">Active Projects</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 2rem; color: var(--pastel-green); font-weight: 600;" id="completeCount">0</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">Completed Projects</div>
                        </div>
                    </div>

                    <div class="filter-controls">
                        <div class="dropdown-wrapper">
                            <button class="dropdown-trigger" onclick="toggleDropdown('category')">
                                Categories ▼
                            </button>
                            <div class="dropdown-menu" id="categoryMenu" style="display: none;"></div>
                        </div>
                        <div class="dropdown-wrapper">
                            <button class="dropdown-trigger" onclick="toggleDropdown('status')">
                                Status ▼
                            </button>
                            <div class="dropdown-menu" id="statusMenu" style="display: none;"></div>
                        </div>
                        <div class="dropdown-wrapper">
                            <button class="dropdown-trigger" onclick="toggleDropdown('user')">
                                Users ▼
                            </button>
                            <div class="dropdown-menu" id="userMenu" style="display: none;"></div>
                        </div>
                        <div class="search-bar">
                            <input type="text" id="searchInput" placeholder="Search projects..." oninput="filterProjects()">
                        </div>
                    </div>

                    <div id="projectsGrid" style="overflow-y: auto; flex: 1;"></div>
                </div>

                <div class="notes-panel">
                    <div class="note-section">
                        <div class="note-header">
                            <h3>Nymbl Notes</h3>
                        </div>
                        <textarea class="note-textarea" id="nymblNotes" placeholder="Notes about Nymbl projects..." oninput="saveNotes()"></textarea>
                    </div>
                    <div class="note-section">
                        <div class="note-header">
                            <h3>Cindy Notes</h3>
                        </div>
                        <textarea class="note-textarea" id="cindyNotes" placeholder="Notes about Cindy's projects..." oninput="saveNotes()"></textarea>
                    </div>
                    <div class="note-section">
                        <div class="note-header">
                            <h3>Personal Notes</h3>
                        </div>
                        <textarea class="note-textarea" id="meNotes" placeholder="Personal project notes..." oninput="saveNotes()"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Page -->
        <div id="timelinePage" class="page-container">
            <div class="timeline-wrapper">
                <div class="timeline-controls">
                    <div class="timeline-controls-left">
                        <button class="btn-primary" onclick="showAddTimelineProjectMenu()">+ Add Projects</button>
                        <div class="dropdown-wrapper">
                            <button class="dropdown-trigger" onclick="toggleDropdown('timelineFilter')">
                                Filters ▼
                            </button>
                            <div class="dropdown-menu" id="timelineFilterMenu" style="display: none;">
                                <div class="dropdown-item" onclick="applyTimelineFilter('all')">Show All</div>
                                <div class="dropdown-item" onclick="applyTimelineFilter('active')">Active Only</div>
                                <div class="dropdown-item" onclick="applyTimelineFilter('healthcare')">Healthcare</div>
                                <div class="dropdown-item" onclick="applyTimelineFilter('abl')">ABL</div>
                            </div>
                        </div>
                        <select id="monthsToShow" onchange="updateTimelineRange()" style="padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);">
                            <option value="6">6 Months</option>
                            <option value="12" selected>12 Months</option>
                            <option value="18">18 Months</option>
                            <option value="24">24 Months</option>
                        </select>
                    </div>
                    <div class="timeline-controls-right">
                        <button class="btn-secondary" onclick="shiftTimelineLeft()">← Previous</button>
                        <button class="btn-secondary" onclick="resetTimelineToToday()">Today</button>
                        <button class="btn-secondary" onclick="shiftTimelineRight()">Next →</button>
                    </div>
                </div>
                
                <div class="timeline-grid-container" id="timelineGridContainer">
                    <div class="timeline-grid" id="timelineGrid"></div>
                </div>

                <div class="timeline-totals" id="timelineTotals" style="display: none;">
                    <h3>Resource Allocation</h3>
                    <table class="resource-table" id="resourceTable"></table>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Project Modal -->
    <div class="modal-overlay" id="projectModal">
        <div class="modal">
            <h2 id="modalTitle">Create New Project</h2>
            <form onsubmit="saveProject(event)">
                <input type="hidden" id="projectId">
                
                <div class="form-group">
                    <label>Project Title *</label>
                    <input type="text" id="projectTitle" required>
                </div>

                <div class="form-group">
                    <label>Status *</label>
                    <select id="projectStatus" required></select>
                </div>

                <div class="form-group">
                    <label>Priority</label>
                    <input type="number" id="projectPriority" value="999">
                </div>

                <div class="form-group">
                    <label>Categories</label>
                    <div class="multi-select" id="projectCategories" onclick="showCategorySelector()"></div>
                </div>

                <div class="form-group">
                    <label>Assigned Users</label>
                    <div class="multi-select" id="projectUsers" onclick="showUserSelector()"></div>
                </div>

                <div class="form-group">
                    <label>Key Details</label>
                    <textarea id="projectDetails"></textarea>
                </div>

                <div class="form-group">
                    <label>Next Steps</label>
                    <textarea id="projectNextSteps"></textarea>
                </div>

                <div class="form-group">
                    <label>Links</label>
                    <textarea id="projectLinks" placeholder="One link per line"></textarea>
                </div>

                <div class="form-group">
                    <label>Start Date (Timeline)</label>
                    <input type="month" id="projectStartMonth">
                </div>

                <div class="form-group">
                    <label>End Date (Timeline)</label>
                    <input type="month" id="projectEndMonth">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeProjectModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Settings Modal -->
    <div class="modal-overlay" id="manageModal">
        <div class="modal">
            <h2>Manage Settings</h2>
            
            <div class="form-group">
                <label>Categories</label>
                <div id="categoriesList"></div>
                <input type="text" id="newCategory" placeholder="Add new category">
                <button type="button" class="btn-primary" style="margin-top: 0.5rem;" onclick="addCategory()">Add Category</button>
            </div>

            <div class="form-group">
                <label>Statuses</label>
                <div id="statusesList"></div>
                <input type="text" id="newStatus" placeholder="Add new status">
                <button type="button" class="btn-primary" style="margin-top: 0.5rem;" onclick="addStatus()">Add Status</button>
            </div>

            <div class="form-group">
                <label>Users</label>
                <div id="usersList"></div>
                <input type="text" id="newUser" placeholder="Add new user">
                <button type="button" class="btn-primary" style="margin-top: 0.5rem;" onclick="addUser()">Add User</button>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeManageModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // APPLICATION STATE
        // ============================================================================
        
        const APP = {
            PASSWORD_HASH: 1869968976,
            projects: [],
            categories: ['ABL', 'Healthcare', 'Liquid Inventory', 'IT / Infrastructure', 'Personal', 'Flagged', 'Nymbl'],
            statuses: ['idea', 'in-progress', 'moving', 'stable', 'on-hold', 'complete', 'person'],
            users: ['Jacob', 'Ben', 'Charlie', 'Jen', 'Holly', 'Sam', 'Grant', 'Benat', 'Nymbl'],
            selectedCategories: [],
            selectedStatuses: [],
            selectedUsers: [],
            lastUpdated: 'Never',
            currentPage: 'projects',
            notes: {
                nymbl: '',
                cindy: '',
                me: ''
            },
            timeline: {
                viewStartDate: new Date(),
                monthsToShow: 12,
                selectedProjects: [],
                dragState: null
            }
        };

        let nextProjectId = 1;

        // ============================================================================
        // PASSWORD & INITIALIZATION
        // ============================================================================

        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash;
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const password = input.value;
            
            if (hashCode(password) === APP.PASSWORD_HASH) {
                document.getElementById('passwordScreen').style.display = 'none';
                document.getElementById('dashboardWrapper').style.display = 'block';
                initializeDashboard();
            } else {
                input.classList.add('error');
                error.classList.add('show');
                setTimeout(() => {
                    input.classList.remove('error');
                    error.classList.remove('show');
                }, 2000);
            }
        }

        function initializeDashboard() {
            updateStats();
            updateFilterDropdowns();
            loadNotes();
            
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-secondary); grid-column: 1 / -1;"><h3>Welcome to PKD Dashboard</h3><p style="margin-top: 1rem;">Upload a PKD file to get started, or create your first project.</p></div>';
            
            document.getElementById('lastUpdatedText').textContent = `Last Updated: ${APP.lastUpdated}`;
        }

        // ============================================================================
        // NAVIGATION
        // ============================================================================

        function showPage(page) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.page-container').forEach(container => container.classList.remove('active'));
            document.getElementById(`${page}Page`).classList.add('active');
            
            const projectsOnlyBtn = document.getElementById('projectsOnlyBtn');
            const manageBtn = document.getElementById('manageBtn');
            
            if (page === 'projects') {
                projectsOnlyBtn.style.display = 'inline-block';
                manageBtn.style.display = 'inline-block';
            } else {
                projectsOnlyBtn.style.display = 'none';
                manageBtn.style.display = 'none';
            }
            
            APP.currentPage = page;
            
            if (page === 'timeline') {
                renderTimeline();
            }
        }

        // ============================================================================
        // STATS & FILTERS
        // ============================================================================

        function updateStats() {
            const active = APP.projects.filter(p => p.status !== 'complete').length;
            const complete = APP.projects.filter(p => p.status === 'complete').length;
            
            document.getElementById('activeCount').textContent = active;
            document.getElementById('completeCount').textContent = complete;
        }

        function updateFilterDropdowns() {
            if (APP.selectedCategories.length === 0 && APP.categories.length > 0) {
                APP.selectedCategories = [...APP.categories];
            }
            if (APP.selectedStatuses.length === 0 && APP.statuses.length > 0) {
                APP.selectedStatuses = [...APP.statuses];
            }
            if (APP.selectedUsers.length === 0 && APP.users.length > 0) {
                APP.selectedUsers = [...APP.users];
            }
            
            const categoryMenu = document.getElementById('categoryMenu');
            categoryMenu.innerHTML = '';
            APP.categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                const isChecked = APP.selectedCategories.includes(cat) ? 'checked' : '';
                item.innerHTML = `
                    <input type="checkbox" id="cat-${cat}" onchange="toggleCategory('${cat}')" ${isChecked}>
                    <label for="cat-${cat}">${cat}</label>
                `;
                categoryMenu.appendChild(item);
            });

            const statusMenu = document.getElementById('statusMenu');
            statusMenu.innerHTML = '';
            APP.statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                const isChecked = APP.selectedStatuses.includes(status) ? 'checked' : '';
                item.innerHTML = `
                    <input type="checkbox" id="status-${status}" onchange="toggleStatus('${status}')" ${isChecked}>
                    <label for="status-${status}">${status}</label>
                `;
                statusMenu.appendChild(item);
            });

            const userMenu = document.getElementById('userMenu');
            userMenu.innerHTML = '';
            APP.users.forEach(user => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                const isChecked = APP.selectedUsers.includes(user) ? 'checked' : '';
                item.innerHTML = `
                    <input type="checkbox" id="user-${user}" onchange="toggleUser('${user}')" ${isChecked}>
                    <label for="user-${user}">${user}</label>
                `;
                userMenu.appendChild(item);
            });
        }

        function toggleDropdown(type) {
            const menus = {
                'category': document.getElementById('categoryMenu'),
                'status': document.getElementById('statusMenu'),
                'user': document.getElementById('userMenu'),
                'timelineFilter': document.getElementById('timelineFilterMenu')
            };
            
            Object.keys(menus).forEach(key => {
                if (key !== type) {
                    menus[key].style.display = 'none';
                }
            });
            
            const menu = menus[type];
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function toggleCategory(cat) {
            const index = APP.selectedCategories.indexOf(cat);
            if (index > -1) {
                APP.selectedCategories.splice(index, 1);
            } else {
                APP.selectedCategories.push(cat);
            }
            filterProjects();
        }

        function toggleStatus(status) {
            const index = APP.selectedStatuses.indexOf(status);
            if (index > -1) {
                APP.selectedStatuses.splice(index, 1);
            } else {
                APP.selectedStatuses.push(status);
            }
            filterProjects();
        }

        function toggleUser(user) {
            const index = APP.selectedUsers.indexOf(user);
            if (index > -1) {
                APP.selectedUsers.splice(index, 1);
            } else {
                APP.selectedUsers.push(user);
            }
            filterProjects();
        }

        function filterProjects() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = APP.projects.filter(project => {
                const matchesSearch = !searchTerm || 
                    project.title.toLowerCase().includes(searchTerm) ||
                    (project.keyDetails && project.keyDetails.toLowerCase().includes(searchTerm));
                
                const matchesCategory = APP.selectedCategories.length === 0 || 
                    (project.categories && project.categories.some(cat => APP.selectedCategories.includes(cat)));
                
                const matchesStatus = APP.selectedStatuses.length === 0 || 
                    APP.selectedStatuses.includes(project.status);
                
                const matchesUser = APP.selectedUsers.length === 0 || 
                    (project.users && project.users.some(user => APP.selectedUsers.includes(user)));
                
                return matchesSearch && matchesCategory && matchesStatus && matchesUser;
            });
            
            renderProjects(filtered);
        }

        function renderProjects(projects) {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = '';
            
            if (projects.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-secondary); grid-column: 1 / -1;">No projects match your filters.</div>';
                return;
            }
            
            const sorted = [...projects].sort((a, b) => {
                if (a.priority === b.priority) return a.id - b.id;
                return a.priority - b.priority;
            });
            
            sorted.forEach(project => {
                const card = createProjectCard(project);
                grid.appendChild(card);
            });
        }

        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';
            
            let statusColor = '--pastel-blue';
            if (project.status === 'complete') statusColor = '--text-secondary';
            else if (project.status === 'on-hold') statusColor = '--pastel-red';
            else if (project.status === 'moving') statusColor = '--pastel-green';
            else if (project.status === 'stable') statusColor = '--pastel-purple';
            else if (project.status === 'in-progress') statusColor = '--pastel-blue';
            else if (project.status === 'idea') statusColor = '--accent-orange';
            
            card.innerHTML = `
                <div class="project-header">
                    <div>
                        <div class="project-title" onclick="openProjectModal(${project.id})">${project.title}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">ID: ${project.id} | Priority: ${project.priority || 999}</div>
                    </div>
                    <span class="status-badge" style="background: var(${statusColor}); color: ${statusColor.includes('text-secondary') ? 'var(--text-secondary)' : 'var(--bg-primary)'};">${project.status}</span>
                </div>
                ${project.users && project.users.length > 0 ? `<div style="margin-bottom: 0.5rem; color: var(--pastel-purple); font-size: 0.875rem;">Users: ${project.users.join(', ')}</div>` : ''}
                <div style="margin: 1rem 0; color: var(--text-secondary); font-size: 0.875rem;">
                    ${project.keyDetails ? project.keyDetails.substring(0, 100) + (project.keyDetails.length > 100 ? '...' : '') : 'No details'}
                </div>
                <div class="project-footer">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${project.categories && project.categories.length > 0 ? project.categories.map(cat => 
                            `<span style="padding: 0.25rem 0.5rem; background: rgba(147, 197, 253, 0.15); border-radius: 6px; font-size: 0.75rem; color: var(--pastel-blue);">${cat}</span>`
                        ).join('') : ''}
                    </div>
                    <div class="project-actions">
                        <button class="edit-btn" style="background: var(--pastel-purple); color: var(--bg-primary); font-weight: 500;" onclick="openEditModal(${project.id})">Edit</button>
                        ${project.status !== 'complete' ? `<button class="edit-btn" style="background: var(--pastel-green); color: var(--bg-primary); font-weight: 500;" onclick="markComplete(${project.id})">Complete</button>` : ''}
                        <button class="edit-btn" style="background: var(--pastel-red); color: var(--bg-primary); font-weight: 500;" onclick="deleteProject(${project.id})">Delete</button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // ============================================================================
        // PROJECT CRUD
        // ============================================================================

        function openCreateModal() {
            document.getElementById('modalTitle').textContent = 'Create New Project';
            document.getElementById('projectId').value = '';
            document.getElementById('projectTitle').value = '';
            document.getElementById('projectStatus').value = 'in-progress';
            document.getElementById('projectPriority').value = '999';
            document.getElementById('projectDetails').value = '';
            document.getElementById('projectNextSteps').value = '';
            document.getElementById('projectLinks').value = '';
            document.getElementById('projectStartMonth').value = '';
            document.getElementById('projectEndMonth').value = '';
            
            updateStatusOptions();
            renderMultiSelect('projectCategories', []);
            renderMultiSelect('projectUsers', []);
            
            document.getElementById('projectModal').classList.add('active');
        }

        function openEditModal(projectId) {
            const project = APP.projects.find(p => p.id === projectId);
            if (!project) return;
            
            document.getElementById('modalTitle').textContent = 'Edit Project';
            document.getElementById('projectId').value = project.id;
            document.getElementById('projectTitle').value = project.title;
            document.getElementById('projectStatus').value = project.status;
            document.getElementById('projectPriority').value = project.priority || 999;
            document.getElementById('projectDetails').value = project.keyDetails || '';
            document.getElementById('projectNextSteps').value = project.nextSteps || '';
            document.getElementById('projectLinks').value = project.links ? project.links.join('\n') : '';
            
            if (project.timeline) {
                document.getElementById('projectStartMonth').value = project.timeline.startMonth || '';
                document.getElementById('projectEndMonth').value = project.timeline.endMonth || '';
            }
            
            updateStatusOptions();
            renderMultiSelect('projectCategories', project.categories || []);
            renderMultiSelect('projectUsers', project.users || []);
            
            document.getElementById('projectModal').classList.add('active');
        }

        function openProjectModal(projectId) {
            openEditModal(projectId);
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
        }

        function updateStatusOptions() {
            const select = document.getElementById('projectStatus');
            select.innerHTML = '';
            APP.statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                select.appendChild(option);
            });
        }

        function renderMultiSelect(elementId, selectedValues) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            selectedValues.forEach(value => {
                const tag = document.createElement('div');
                tag.className = 'multi-select-tag';
                tag.innerHTML = `
                    ${value}
                    <button type="button" onclick="removeFromMultiSelect('${elementId}', '${value}')">×</button>
                `;
                container.appendChild(tag);
            });
        }

        function removeFromMultiSelect(elementId, value) {
            const container = document.getElementById(elementId);
            const tags = Array.from(container.children);
            const tag = tags.find(t => t.textContent.trim().startsWith(value));
            if (tag) tag.remove();
        }

        function showCategorySelector() {
            const selected = Array.from(document.getElementById('projectCategories').children).map(tag => 
                tag.textContent.trim().replace('×', '').trim()
            );
            
            const available = APP.categories.filter(cat => !selected.includes(cat));
            if (available.length === 0) {
                showNotification('All categories are already selected', 'info');
                return;
            }
            
            const choice = available[0];
            if (choice) {
                selected.push(choice);
                renderMultiSelect('projectCategories', selected);
            }
        }

        function showUserSelector() {
            const selected = Array.from(document.getElementById('projectUsers').children).map(tag => 
                tag.textContent.trim().replace('×', '').trim()
            );
            
            const available = APP.users.filter(user => !selected.includes(user));
            if (available.length === 0) {
                showNotification('All users are already selected', 'info');
                return;
            }
            
            const choice = available[0];
            if (choice) {
                selected.push(choice);
                renderMultiSelect('projectUsers', selected);
            }
        }

        function saveProject(event) {
            event.preventDefault();
            
            const id = document.getElementById('projectId').value;
            const title = document.getElementById('projectTitle').value;
            const status = document.getElementById('projectStatus').value;
            const priority = parseInt(document.getElementById('projectPriority').value);
            const keyDetails = document.getElementById('projectDetails').value;
            const nextSteps = document.getElementById('projectNextSteps').value;
            const linksText = document.getElementById('projectLinks').value;
            const links = linksText ? linksText.split('\n').filter(l => l.trim()) : [];
            
            const categories = Array.from(document.getElementById('projectCategories').children).map(tag => 
                tag.textContent.trim().replace('×', '').trim()
            );
            
            const users = Array.from(document.getElementById('projectUsers').children).map(tag => 
                tag.textContent.trim().replace('×', '').trim()
            );

            const startMonth = document.getElementById('projectStartMonth').value;
            const endMonth = document.getElementById('projectEndMonth').value;
            
            const project = {
                id: id ? parseInt(id) : nextProjectId++,
                title,
                status,
                priority,
                categories,
                users,
                keyDetails,
                nextSteps,
                links,
                timeline: {
                    startMonth: startMonth || null,
                    endMonth: endMonth || null,
                    startWeek: 0,
                    endWeek: 3,
                    displayOrder: 0
                }
            };
            
            if (id) {
                const index = APP.projects.findIndex(p => p.id === project.id);
                if (index > -1) {
                    APP.projects[index] = project;
                }
            } else {
                APP.projects.push(project);
            }
            
            closeProjectModal();
            updateStats();
            filterProjects();
            showNotification('Project saved successfully', 'success');
        }

        function markComplete(projectId) {
            const project = APP.projects.find(p => p.id === projectId);
            if (project) {
                project.status = 'complete';
                filterProjects();
                updateStats();
                showNotification('Project marked as complete', 'success');
            }
        }

        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                const index = APP.projects.findIndex(p => p.id === projectId);
                if (index > -1) {
                    APP.projects.splice(index, 1);
                    filterProjects();
                    updateStats();
                    showNotification('Project deleted', 'success');
                }
            }
        }

        // ============================================================================
        // MANAGE SETTINGS
        // ============================================================================

        function openManageModal() {
            renderSettingsList('categories', APP.categories);
            renderSettingsList('statuses', APP.statuses);
            renderSettingsList('users', APP.users);
            document.getElementById('manageModal').classList.add('active');
        }

        function closeManageModal() {
            document.getElementById('manageModal').classList.remove('active');
        }

        function renderSettingsList(type, items) {
            const container = document.getElementById(`${type}List`);
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'settings-list-item';
                div.draggable = true;
                div.dataset.index = index;
                div.innerHTML = `
                    <span class="drag-handle">☰</span>
                    <span style="flex: 1;">${item}</span>
                    <button type="button" onclick="removeSetting('${type}', ${index})" style="background: var(--pastel-red); color: var(--bg-primary); border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer;">×</button>
                `;
                container.appendChild(div);
            });
        }

        function addCategory() {
            const input = document.getElementById('newCategory');
            const value = input.value.trim();
            if (value && !APP.categories.includes(value)) {
                APP.categories.push(value);
                renderSettingsList('categories', APP.categories);
                input.value = '';
                updateFilterDropdowns();
                showNotification('Category added', 'success');
            }
        }

        function addStatus() {
            const input = document.getElementById('newStatus');
            const value = input.value.trim();
            if (value && !APP.statuses.includes(value)) {
                APP.statuses.push(value);
                renderSettingsList('statuses', APP.statuses);
                input.value = '';
                updateFilterDropdowns();
                showNotification('Status added', 'success');
            }
        }

        function addUser() {
            const input = document.getElementById('newUser');
            const value = input.value.trim();
            if (value && !APP.users.includes(value)) {
                APP.users.push(value);
                renderSettingsList('users', APP.users);
                input.value = '';
                updateFilterDropdowns();
                showNotification('User added', 'success');
            }
        }

        function removeSetting(type, index) {
            const array = APP[type];
            array.splice(index, 1);
            renderSettingsList(type, array);
            updateFilterDropdowns();
            showNotification('Item removed', 'success');
        }

        // ============================================================================
        // NOTES
        // ============================================================================

        function loadNotes() {
            document.getElementById('nymblNotes').value = APP.notes.nymbl || '';
            document.getElementById('cindyNotes').value = APP.notes.cindy || '';
            document.getElementById('meNotes').value = APP.notes.me || '';
        }

        function saveNotes() {
            APP.notes.nymbl = document.getElementById('nymblNotes').value;
            APP.notes.cindy = document.getElementById('cindyNotes').value;
            APP.notes.me = document.getElementById('meNotes').value;
        }

        // ============================================================================
        // TIMELINE VIEW
        // ============================================================================

        function getMonthsBetween(start, count) {
            const months = [];
            const current = new Date(start);
            
            for (let i = 0; i < count; i++) {
                months.push({
                    year: current.getFullYear(),
                    month: current.getMonth(),
                    label: current.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),
                    key: `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}`
                });
                current.setMonth(current.getMonth() + 1);
            }
            
            return months;
        }

        function renderTimeline() {
            const months = getMonthsBetween(APP.timeline.viewStartDate, APP.timeline.monthsToShow);
            const grid = document.getElementById('timelineGrid');
            grid.style.setProperty('--months-count', months.length);
            
            // Filter projects that have timeline data
            const timelineProjects = APP.projects.filter(p => 
                p.timeline && p.timeline.startMonth && p.timeline.endMonth &&
                APP.timeline.selectedProjects.includes(p.id)
            ).sort((a, b) => (a.timeline.displayOrder || 0) - (b.timeline.displayOrder || 0));
            
            // Build header
            let html = `
                <div class="timeline-header-label">Project</div>
            `;
            
            months.forEach(month => {
                html += `<div class="timeline-header-cell">${month.label}</div>`;
            });
            
            // Build project rows
            timelineProjects.forEach(project => {
                html += `
                    <div class="timeline-project-label" data-project-id="${project.id}" draggable="true">
                        <span class="drag-handle">☰</span>
                        <span>${project.title}</span>
                    </div>
                `;
                
                // Add cells for each month
                months.forEach((month, idx) => {
                    html += `<div class="timeline-cell" data-month="${month.key}" data-project-id="${project.id}" data-month-index="${idx}"></div>`;
                });
            });
            
            grid.innerHTML = html;
            
            // Add project bars
            timelineProjects.forEach(project => {
                addProjectBar(project, months);
            });
            
            // Setup drag handlers
            setupTimelineDragHandlers();
            
            // Update resource allocation
            updateResourceAllocation(months);
        }

        function addProjectBar(project, months) {
            if (!project.timeline.startMonth || !project.timeline.endMonth) return;
            
            const startMonthKey = project.timeline.startMonth;
            const endMonthKey = project.timeline.endMonth;
            
            const startIndex = months.findIndex(m => m.key === startMonthKey);
            const endIndex = months.findIndex(m => m.key === endMonthKey);
            
            if (startIndex === -1 || endIndex === -1) return;
            
            // Find the first cell for this project
            const firstCell = document.querySelector(`.timeline-cell[data-project-id="${project.id}"][data-month-index="${startIndex}"]`);
            if (!firstCell) return;
            
            const monthWidth = 120;
            const startWeekOffset = (project.timeline.startWeek || 0) * (monthWidth / 4);
            const endWeekOffset = (project.timeline.endWeek || 3) * (monthWidth / 4);
            
            const left = startWeekOffset;
            const width = ((endIndex - startIndex) * monthWidth) + endWeekOffset - startWeekOffset;
            
            let statusColor = 'var(--pastel-blue)';
            if (project.status === 'complete') statusColor = 'var(--text-secondary)';
            else if (project.status === 'on-hold') statusColor = 'var(--pastel-red)';
            else if (project.status === 'moving') statusColor = 'var(--pastel-green)';
            else if (project.status === 'stable') statusColor = 'var(--pastel-purple)';
            else if (project.status === 'idea') statusColor = 'var(--accent-orange)';
            
            const bar = document.createElement('div');
            bar.className = 'timeline-bar';
            bar.dataset.projectId = project.id;
            bar.style.left = `${left}px`;
            bar.style.width = `${width}px`;
            bar.style.background = statusColor;
            bar.style.color = project.status === 'complete' ? 'var(--text-secondary)' : 'var(--bg-primary)';
            
            const userBadges = project.users ? project.users.map(u => 
                `<span class="user-badge">${u}</span>`
            ).join('') : '';
            
            bar.innerHTML = `
                <div class="resize-handle resize-handle-left" data-project-id="${project.id}"></div>
                <div class="timeline-bar-content">
                    <span>${project.title}</span>
                    ${userBadges}
                </div>
                <div class="resize-handle resize-handle-right" data-project-id="${project.id}"></div>
            `;
            
            firstCell.appendChild(bar);
            
            // Add drag handlers for the bar
            bar.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('resize-handle')) return;
                startBarDrag(e, project);
            });
            
            // Add resize handlers
            const leftHandle = bar.querySelector('.resize-handle-left');
            const rightHandle = bar.querySelector('.resize-handle-right');
            
            leftHandle.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                startResize(e, project, 'left');
            });
            
            rightHandle.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                startResize(e, project, 'right');
            });
        }

        function startBarDrag(e, project) {
            e.preventDefault();
            
            const bar = e.currentTarget;
            const rect = bar.getBoundingClientRect();
            
            APP.timeline.dragState = {
                type: 'move',
                projectId: project.id,
                startX: e.clientX,
                startLeft: rect.left,
                originalStartMonth: project.timeline.startMonth,
                originalEndMonth: project.timeline.endMonth,
                originalStartWeek: project.timeline.startWeek || 0,
                originalEndWeek: project.timeline.endWeek || 3
            };
            
            bar.classList.add('dragging');
            
            document.addEventListener('mousemove', handleBarDrag);
            document.addEventListener('mouseup', endBarDrag);
        }

        function handleBarDrag(e) {
            if (!APP.timeline.dragState || APP.timeline.dragState.type !== 'move') return;
            
            const deltaX = e.clientX - APP.timeline.dragState.startX;
            const monthWidth = 120;
            const quarterMonths = Math.round(deltaX / (monthWidth / 4));
            
            // Update project dates
            const project = APP.projects.find(p => p.id === APP.timeline.dragState.projectId);
            if (!project) return;
            
            const newDates = offsetMonthsByQuarters(
                APP.timeline.dragState.originalStartMonth,
                APP.timeline.dragState.originalEndMonth,
                APP.timeline.dragState.originalStartWeek,
                APP.timeline.dragState.originalEndWeek,
                quarterMonths
            );
            
            project.timeline.startMonth = newDates.startMonth;
            project.timeline.endMonth = newDates.endMonth;
            project.timeline.startWeek = newDates.startWeek;
            project.timeline.endWeek = newDates.endWeek;
            
            renderTimeline();
        }

        function endBarDrag(e) {
            if (!APP.timeline.dragState) return;
            
            const bar = document.querySelector(`.timeline-bar[data-project-id="${APP.timeline.dragState.projectId}"]`);
            if (bar) bar.classList.remove('dragging');
            
            APP.timeline.dragState = null;
            
            document.removeEventListener('mousemove', handleBarDrag);
            document.removeEventListener('mouseup', endBarDrag);
            
            showNotification('Project timeline updated', 'success');
        }

        function startResize(e, project, edge) {
            e.preventDefault();
            e.stopPropagation();
            
            APP.timeline.dragState = {
                type: 'resize',
                edge: edge,
                projectId: project.id,
                startX: e.clientX,
                originalStartMonth: project.timeline.startMonth,
                originalEndMonth: project.timeline.endMonth,
                originalStartWeek: project.timeline.startWeek || 0,
                originalEndWeek: project.timeline.endWeek || 3
            };
            
            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', endResize);
        }

        function handleResize(e) {
            if (!APP.timeline.dragState || APP.timeline.dragState.type !== 'resize') return;
            
            const deltaX = e.clientX - APP.timeline.dragState.startX;
            const monthWidth = 120;
            const quarterMonths = Math.round(deltaX / (monthWidth / 4));
            
            const project = APP.projects.find(p => p.id === APP.timeline.dragState.projectId);
            if (!project) return;
            
            if (APP.timeline.dragState.edge === 'left') {
                const newStart = offsetMonthByQuarters(
                    APP.timeline.dragState.originalStartMonth,
                    APP.timeline.dragState.originalStartWeek,
                    quarterMonths
                );
                
                if (isBeforeOrEqual(newStart.month, project.timeline.endMonth)) {
                    project.timeline.startMonth = newStart.month;
                    project.timeline.startWeek = newStart.week;
                }
            } else {
                const newEnd = offsetMonthByQuarters(
                    APP.timeline.dragState.originalEndMonth,
                    APP.timeline.dragState.originalEndWeek,
                    quarterMonths
                );
                
                if (isBeforeOrEqual(project.timeline.startMonth, newEnd.month)) {
                    project.timeline.endMonth = newEnd.month;
                    project.timeline.endWeek = newEnd.week;
                }
            }
            
            renderTimeline();
        }

        function endResize(e) {
            APP.timeline.dragState = null;
            
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', endResize);
            
            showNotification('Project timeline updated', 'success');
        }

        function setupTimelineDragHandlers() {
            const labels = document.querySelectorAll('.timeline-project-label');
            
            labels.forEach(label => {
                label.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', label.dataset.projectId);
                    label.style.opacity = '0.5';
                });
                
                label.addEventListener('dragend', (e) => {
                    label.style.opacity = '1';
                });
                
                label.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                
                label.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedId = parseInt(e.dataTransfer.getData('text/plain'));
                    const targetId = parseInt(label.dataset.projectId);
                    
                    if (draggedId !== targetId) {
                        reorderTimelineProjects(draggedId, targetId);
                    }
                });
            });
        }

        function reorderTimelineProjects(draggedId, targetId) {
            const draggedProject = APP.projects.find(p => p.id === draggedId);
            const targetProject = APP.projects.find(p => p.id === targetId);
            
            if (!draggedProject || !targetProject) return;
            
            const draggedOrder = draggedProject.timeline.displayOrder || 0;
            const targetOrder = targetProject.timeline.displayOrder || 0;
            
            draggedProject.timeline.displayOrder = targetOrder;
            targetProject.timeline.displayOrder = draggedOrder;
            
            renderTimeline();
            showNotification('Project order updated', 'success');
        }

        function offsetMonthsByQuarters(startMonth, endMonth, startWeek, endWeek, quarters) {
            const start = offsetMonthByQuarters(startMonth, startWeek, quarters);
            const end = offsetMonthByQuarters(endMonth, endWeek, quarters);
            
            return {
                startMonth: start.month,
                endMonth: end.month,
                startWeek: start.week,
                endWeek: end.week
            };
        }

        function offsetMonthByQuarters(monthKey, week, quarters) {
            const [year, month] = monthKey.split('-').map(Number);
            const date = new Date(year, month - 1, 1);
            
            const totalWeeks = week + quarters;
            const monthOffset = Math.floor(totalWeeks / 4);
            const newWeek = ((totalWeeks % 4) + 4) % 4;
            
            date.setMonth(date.getMonth() + monthOffset);
            
            return {
                month: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`,
                week: newWeek
            };
        }

        function isBeforeOrEqual(month1, month2) {
            const [y1, m1] = month1.split('-').map(Number);
            const [y2, m2] = month2.split('-').map(Number);
            
            if (y1 < y2) return true;
            if (y1 > y2) return false;
            return m1 <= m2;
        }

        function updateTimelineRange() {
            APP.timeline.monthsToShow = parseInt(document.getElementById('monthsToShow').value);
            renderTimeline();
        }

        function shiftTimelineLeft() {
            const date = new Date(APP.timeline.viewStartDate);
            date.setMonth(date.getMonth() - 3);
            APP.timeline.viewStartDate = date;
            renderTimeline();
        }

        function shiftTimelineRight() {
            const date = new Date(APP.timeline.viewStartDate);
            date.setMonth(date.getMonth() + 3);
            APP.timeline.viewStartDate = date;
            renderTimeline();
        }

        function resetTimelineToToday() {
            APP.timeline.viewStartDate = new Date();
            renderTimeline();
        }

        function showAddTimelineProjectMenu() {
            const availableProjects = APP.projects.filter(p => 
                p.timeline && p.timeline.startMonth && p.timeline.endMonth &&
                !APP.timeline.selectedProjects.includes(p.id)
            );
            
            if (availableProjects.length === 0) {
                showNotification('No projects available to add. Make sure projects have start and end dates.', 'info');
                return;
            }
            
            // Simple implementation: add the first available project
            const project = availableProjects[0];
            APP.timeline.selectedProjects.push(project.id);
            project.timeline.displayOrder = APP.timeline.selectedProjects.length - 1;
            
            renderTimeline();
            showNotification(`Added ${project.title} to timeline`, 'success');
        }

        function applyTimelineFilter(filterType) {
            if (filterType === 'all') {
                APP.timeline.selectedProjects = APP.projects
                    .filter(p => p.timeline && p.timeline.startMonth && p.timeline.endMonth)
                    .map(p => p.id);
            } else if (filterType === 'active') {
                APP.timeline.selectedProjects = APP.projects
                    .filter(p => p.timeline && p.timeline.startMonth && p.timeline.endMonth && p.status !== 'complete')
                    .map(p => p.id);
            } else if (filterType === 'healthcare') {
                APP.timeline.selectedProjects = APP.projects
                    .filter(p => p.timeline && p.timeline.startMonth && p.timeline.endMonth && 
                           p.categories && p.categories.includes('Healthcare'))
                    .map(p => p.id);
            } else if (filterType === 'abl') {
                APP.timeline.selectedProjects = APP.projects
                    .filter(p => p.timeline && p.timeline.startMonth && p.timeline.endMonth && 
                           p.categories && p.categories.includes('ABL'))
                    .map(p => p.id);
            }
            
            renderTimeline();
            document.getElementById('timelineFilterMenu').style.display = 'none';
        }

        function updateResourceAllocation(months) {
            const allocation = {};
            
            APP.users.forEach(user => {
                allocation[user] = months.map(() => 0);
            });
            
            APP.timeline.selectedProjects.forEach(projectId => {
                const project = APP.projects.find(p => p.id === projectId);
                if (!project || !project.users) return;
                
                months.forEach((month, idx) => {
                    if (isProjectActiveInMonth(project, month.key)) {
                        project.users.forEach(user => {
                            if (allocation[user]) {
                                allocation[user][idx]++;
                            }
                        });
                    }
                });
            });
            
            // Render resource table
            const hasData = Object.values(allocation).some(counts => counts.some(c => c > 0));
            
            if (!hasData) {
                document.getElementById('timelineTotals').style.display = 'none';
                return;
            }
            
            document.getElementById('timelineTotals').style.display = 'block';
            
            let tableHTML = '<tr><th>User</th>';
            months.forEach(month => {
                tableHTML += `<th>${month.label.split(' ')[0]}</th>`;
            });
            tableHTML += '<th>Total</th></tr>';
            
            Object.keys(allocation).forEach(user => {
                const counts = allocation[user];
                const total = counts.reduce((a, b) => a + b, 0);
                
                if (total === 0) return;
                
                tableHTML += `<tr><td style="text-align: left; font-weight: 600;">${user}</td>`;
                
                counts.forEach(count => {
                    let className = 'resource-allocation-healthy';
                    if (count >= 5) className = 'resource-allocation-danger';
                    else if (count >= 3) className = 'resource-allocation-warning';
                    
                    tableHTML += `<td class="${className}">${count}</td>`;
                });
                
                tableHTML += `<td style="font-weight: 600;">${total}</td></tr>`;
            });
            
            document.getElementById('resourceTable').innerHTML = tableHTML;
        }

        function isProjectActiveInMonth(project, monthKey) {
            if (!project.timeline || !project.timeline.startMonth || !project.timeline.endMonth) {
                return false;
            }
            
            return !isBeforeOrEqual(monthKey, getPreviousMonth(project.timeline.startMonth)) &&
                   !isBeforeOrEqual(getNextMonth(project.timeline.endMonth), monthKey);
        }

        function getPreviousMonth(monthKey) {
            const [year, month] = monthKey.split('-').map(Number);
            const date = new Date(year, month - 1, 1);
            date.setMonth(date.getMonth() - 1);
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        }

        function getNextMonth(monthKey) {
            const [year, month] = monthKey.split('-').map(Number);
            const date = new Date(year, month - 1, 1);
            date.setMonth(date.getMonth() + 1);
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        }

        // ============================================================================
        // EXPORT/IMPORT
        // ============================================================================

        function exportPKD() {
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            let content = `**Project Knowledge Document**\n\n`;
            content += `*Last Updated: ${dateStr}*\n\n`;
            
            // Timeline configuration
            content += `<!-- TIMELINE_DATA_START\n`;
            content += JSON.stringify({
                timelineProjects: APP.timeline.selectedProjects,
                timelineMonthsToShow: APP.timeline.monthsToShow,
                timelineStartDate: APP.timeline.viewStartDate.toISOString()
            }, null, 2);
            content += `\nTIMELINE_DATA_END -->\n\n`;
            
            content += `**Quick Reference List**\n\n`;
            APP.projects.forEach((project, index) => {
                content += `${index + 1}.  ${project.title}\n\n`;
            });
            
            content += `**Users List**\n\n`;
            APP.users.forEach(user => {
                content += `-   ${user}\n`;
            });
            
            content += `\n**Active Projects**\n\n`;
            
            APP.projects.forEach(project => {
                content += `**${project.id}. ${project.title}**\n\n`;
                content += `-   **Status**: ${project.status}\n\n`;
                content += `-   **Priority**: ${project.priority || 999}\n\n`;
                
                if (project.categories && project.categories.length > 0) {
                    content += `-   **Project Category**: ${project.categories.join(', ')}\n\n`;
                }
                
                if (project.users && project.users.length > 0) {
                    content += `-   **Users**: ${project.users.join(', ')}\n\n`;
                }
                
                if (project.keyDetails) {
                    content += `-   **Key Details**: ${project.keyDetails}\n\n`;
                }
                
                if (project.nextSteps) {
                    content += `-   **Next Steps**: ${project.nextSteps}\n\n`;
                }
                
                if (project.links && project.links.length > 0) {
                    content += `-   **Links**: ${project.links.map(link => `[Link](${link})`).join(', ')}\n\n`;
                }
                
                if (project.timeline && project.timeline.startMonth) {
                    content += `-   **Timeline**: ${project.timeline.startMonth} to ${project.timeline.endMonth} (Order: ${project.timeline.displayOrder || 0})\n\n`;
                }
            });
            
            content += `**Notes**\n\n`;
            content += `**Nymbl**\n\n${APP.notes.nymbl || 'No notes'}\n\n`;
            content += `**Cindy**\n\n${APP.notes.cindy || 'No notes'}\n\n`;
            content += `**Me**\n\n${APP.notes.me || 'No notes'}\n\n`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `PKD_${today.getFullYear()}_${(today.getMonth() + 1).toString().padStart(2, '0')}_${today.getDate().toString().padStart(2, '0')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            APP.lastUpdated = dateStr;
            document.getElementById('lastUpdatedText').textContent = `Last Updated: ${APP.lastUpdated}`;
            showNotification('PKD exported successfully', 'success');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const parsed = parsePKDContent(content);
                
                APP.projects = parsed.projects;
                APP.categories = parsed.categories.length > 0 ? parsed.categories : APP.categories;
                APP.statuses = parsed.statuses.length > 0 ? parsed.statuses : APP.statuses;
                APP.users = parsed.users.length > 0 ? parsed.users : APP.users;
                APP.lastUpdated = parsed.lastUpdated;
                APP.notes = parsed.notes;
                APP.timeline.selectedProjects = parsed.timelineProjects || [];
                APP.timeline.monthsToShow = parsed.timelineMonthsToShow || 12;
                
                if (parsed.timelineStartDate) {
                    APP.timeline.viewStartDate = new Date(parsed.timelineStartDate);
                }
                
                nextProjectId = Math.max(...APP.projects.map(p => p.id), 0) + 1;
                
                updateStats();
                updateFilterDropdowns();
                filterProjects();
                loadNotes();
                
                document.getElementById('lastUpdatedText').textContent = `Last Updated: ${APP.lastUpdated}`;
                showNotification('PKD loaded successfully', 'success');
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        function parsePKDContent(content) {
            const result = {
                projects: [],
                categories: [],
                statuses: [],
                users: [],
                lastUpdated: 'Never',
                notes: {
                    nymbl: '',
                    cindy: '',
                    me: ''
                },
                timelineProjects: [],
                timelineMonthsToShow: 12,
                timelineStartDate: null
            };
            
            // Parse timeline data
            const timelineDataMatch = content.match(/<!-- TIMELINE_DATA_START\n([\s\S]*?)\nTIMELINE_DATA_END -->/);
            if (timelineDataMatch) {
                try {
                    const timelineData = JSON.parse(timelineDataMatch[1]);
                    result.timelineProjects = timelineData.timelineProjects || [];
                    result.timelineMonthsToShow = timelineData.timelineMonthsToShow || 12;
                    result.timelineStartDate = timelineData.timelineStartDate ? new Date(timelineData.timelineStartDate) : null;
                } catch (e) {
                    console.error('Error parsing timeline data:', e);
                }
            }
            
            const categoriesSet = new Set();
            const statusesSet = new Set();
            const usersSet = new Set();
            
            const lines = content.split('\n');
            
            for (let i = 0; i < Math.min(lines.length, 20); i++) {
                const line = lines[i];
                if (line.includes('Last Updated:')) {
                    const match = line.match(/\*Last Updated:\s*(.+?)\*/);
                    if (match) {
                        result.lastUpdated = match[1].trim();
                        break;
                    }
                }
            }
            
            const projectsStart = lines.findIndex(line => line.includes('**Active Projects**'));
            const notesStart = lines.findIndex(line => line.includes('**Notes**'));
            const usersStart = lines.findIndex(line => line.includes('**Users List**'));
            
            if (usersStart !== -1 && usersStart < projectsStart) {
                const usersEnd = projectsStart !== -1 ? projectsStart : lines.length;
                for (let i = usersStart + 1; i < usersEnd; i++) {
                    const line = lines[i].trim();
                    if (line.startsWith('-')) {
                        const user = line.replace(/^-\s*/, '').trim();
                        if (user && !line.includes('**')) {
                            usersSet.add(user);
                        }
                    }
                }
            }
            
            if (projectsStart === -1) {
                return result;
            }
            
            let currentProject = null;
            const projectsEnd = notesStart !== -1 ? notesStart : lines.length;
            
            for (let i = projectsStart + 1; i < projectsEnd; i++) {
                const line = lines[i].trim();
                
                if (line.match(/^\*\*\d+\.\s+.+\*\*$/)) {
                    if (currentProject) {
                        result.projects.push(currentProject);
                    }
                    
                    const match = line.match(/^\*\*(\d+)\.\s+(.+?)\*\*$/);
                    if (match) {
                        currentProject = {
                            id: parseInt(match[1]),
                            title: match[2],
                            status: 'in-progress',
                            priority: 999,
                            categories: [],
                            users: [],
                            keyDetails: '',
                            nextSteps: '',
                            links: [],
                            timeline: {
                                startMonth: null,
                                endMonth: null,
                                startWeek: 0,
                                endWeek: 3,
                                displayOrder: 0
                            }
                        };
                    }
                } else if (currentProject && line.startsWith('-')) {
                    if (line.includes('**Status**:')) {
                        const status = line.split('**Status**:')[1].trim();
                        currentProject.status = status;
                        statusesSet.add(status);
                    } else if (line.includes('**Priority**:')) {
                        const priority = parseInt(line.split('**Priority**:')[1].trim());
                        currentProject.priority = priority;
                    } else if (line.includes('**Project Category**:')) {
                        const cats = line.split('**Project Category**:')[1].split(',').map(c => c.trim());
                        currentProject.categories = cats;
                        cats.forEach(cat => categoriesSet.add(cat));
                    } else if (line.includes('**Users**:')) {
                        const users = line.split('**Users**:')[1].split(',').map(u => u.trim());
                        currentProject.users = users;
                        users.forEach(user => usersSet.add(user));
                    } else if (line.includes('**Key Details**:')) {
                        currentProject.keyDetails = line.split('**Key Details**:')[1].trim();
                    } else if (line.includes('**Next Steps**:')) {
                        currentProject.nextSteps = line.split('**Next Steps**:')[1].trim();
                    } else if (line.includes('**Timeline**:')) {
                        const timelineMatch = line.match(/(\d{4}-\d{2})\s+to\s+(\d{4}-\d{2})\s+\(Order:\s+(\d+)\)/);
                        if (timelineMatch) {
                            currentProject.timeline.startMonth = timelineMatch[1];
                            currentProject.timeline.endMonth = timelineMatch[2];
                            currentProject.timeline.displayOrder = parseInt(timelineMatch[3]);
                        }
                    }
                }
            }
            
            if (currentProject) {
                result.projects.push(currentProject);
            }
            
            // Parse notes
            if (notesStart !== -1) {
                let currentNoteType = null;
                let noteContent = [];
                
                for (let i = notesStart + 1; i < lines.length; i++) {
                    const line = lines[i];
                    
                    if (line.includes('**Nymbl**')) {
                        if (currentNoteType && noteContent.length > 0) {
                            result.notes[currentNoteType] = noteContent.join('\n').trim();
                        }
                        currentNoteType = 'nymbl';
                        noteContent = [];
                    } else if (line.includes('**Cindy**')) {
                        if (currentNoteType && noteContent.length > 0) {
                            result.notes[currentNoteType] = noteContent.join('\n').trim();
                        }
                        currentNoteType = 'cindy';
                        noteContent = [];
                    } else if (line.includes('**Me**')) {
                        if (currentNoteType && noteContent.length > 0) {
                            result.notes[currentNoteType] = noteContent.join('\n').trim();
                        }
                        currentNoteType = 'me';
                        noteContent = [];
                    } else if (currentNoteType) {
                        noteContent.push(line);
                    }
                }
                
                if (currentNoteType && noteContent.length > 0) {
                    result.notes[currentNoteType] = noteContent.join('\n').trim();
                }
            }
            
            result.categories = Array.from(categoriesSet);
            result.statuses = Array.from(statusesSet);
            result.users = Array.from(usersSet);
            
            return result;
        }

        // ============================================================================
        // NOTIFICATIONS
        // ============================================================================

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown-wrapper')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>
